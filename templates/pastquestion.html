<!-- cbt.html -->
{% extends 'cool/nav.html' %}

{% block content %}

<head>
    <style>/* main.css */
        * {
            box-sizing: border-box;
          }
          
          html,
          body {
            height: 100%;
            width: 100%; 
          }
          
          body {
            background-color: #eee;
            color: #242424;
          }
          
          button {
            border: none;
            background-color: rgb(52, 52, 209);
            color: #fff;
            cursor: pointer;
            &:hover {
              opacity: 0.8;
            }
          }
          
          .container {
            background-color: #fff;
            width: clamp(60vw, 800px, 90vw);
            position: relative;
            box-shadow: 14px 14px 4px 0px rgba(0, 0, 0, 0.3);
          }
          
          .game {
            display: flex;
            flex-direction: column;
          }
          
          .content {
            padding: 2.5rem;
          }
          
          .question {
            font-size: 1.3rem;
          }
          
          .answer {
            font-size: 1rem;
            color: #333;
            margin-bottom: 0.75rem;
          }
          
          .submit {
            height: 50px;
            font-size: 1.25rem;
          }
          
          .result {
            padding: 2.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
         }
          
          .row {
            display: flex;
            justify-content: space-around;
            font-size: 1.5rem;
          }
          
          .correct {
            color: #24936e;
          }
          
          .wrong {
            color: #9f353a;
          }
          
          .explanation {
            li:not(:last-child) {
              margin-bottom: 0.5rem;
            }
          }
          
          .restart {
            padding: 10px 20px;
            font-size: 1.25rem;
          }
          
          .hidden {
            display: none;
          }
          
          .bold {
            font-weight: bold;
          }

          .answerContainer {
            display: none;
          }
          
          .answerContainer.active {
            display: block;
          }
          img{
            width: 100%;
          }
          .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        .submit {
            width: 48%;
        }
    
        
          
    
    </style>
</head>
<div class="container">
    <form id="quizForm" method="POST" action="">
        {% csrf_token %}

        <div class="game">
            <div class="content">
              <h2 style="text-align: center; margin:20px">{{ course.name }} Past Questions Practice</h2>
              <h3><span id="time"></span> minutes!</h3>

                {% for question in cbt_questions %}
                <div class="answerContainer {% if forloop.first %}active{% endif %}">
                    <h2 class="question">{{ question.question_text|safe }}</h2>
                    <div class="answer">
                        <input type="radio" name="question_{{ question.id }}" value="A" id="question_{{ question.id }}_A">
                        <label for="question_{{ question.id }}_A">{{ question.option_a }}</label>
                    </div>
                    <div class="answer">
                        <input type="radio" name="question_{{ question.id }}" value="B" id="question_{{ question.id }}_B">
                        <label for="question_{{ question.id }}_B">{{ question.option_b }}</label>
                    </div>
                    <div class="answer">
                        <input type="radio" name="question_{{ question.id }}" value="C" id="question_{{ question.id }}_C">
                        <label for="question_{{ question.id }}_C">{{ question.option_c }}</label>
                    </div>
                    <div class="answer">
                        <input type="radio" name="question_{{ question.id }}" value="D" id="question_{{ question.id }}_D">
                        <label for="question_{{ question.id }}_D">{{ question.option_d }}</label>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="navigation-buttons">
                <button type="button" id="prevButton" class="submit">Previous</button>
                <button type="button" id="nextButton" class="submit">Next</button>
            </div>
        </div>
        
    </form>
</div>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const questions = document.querySelectorAll(".answerContainer");
    const nextButton = document.getElementById("nextButton");
    const prevButton = document.getElementById("prevButton");
    let currentIndex = 0;

    const showQuestion = (index) => {
        // Hide all questions
        questions.forEach((question) => question.classList.remove("active"));
        // Show the current question
        questions[index].classList.add("active");

        // Update button text based on the question index
        if (index === questions.length - 1) {
            nextButton.textContent = "Submit"; // Change to Submit on the last question
            nextButton.style.backgroundColor="red"
        } else {
            nextButton.textContent = "Next"; // Change back to Next otherwise
            nextButton.style.backgroundColor="rgb(52, 52, 209)"

        }
        
    };

    nextButton.addEventListener("click", () => {
        if (currentIndex < questions.length - 1) {
            currentIndex++;
            showQuestion(currentIndex);
        } else {
            // When the last question is reached, submit the form
            document.getElementById("quizForm").submit();
        }
    });

    prevButton.addEventListener("click", () => {
        if (currentIndex > 0) {
            currentIndex--;
            showQuestion(currentIndex);
        }
    });

    // Initialize the first question
    showQuestion(currentIndex);
});

  function startTimer(duration, display) {
    var timer = duration, minutes, seconds;
    var timerInterval = setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        // Change color based on remaining time
        if (timer <= 30) {
            display.style.color = "red"; // Less than or equal to 30 seconds
        } else if (timer <= 60) {
            display.style.color = "yellow"; // Between 31 and 60 seconds
        } else {
            display.style.color = "green"; // More than 60 seconds
        }

        if (--timer < 0) {
            clearInterval(timerInterval); // Stop the timer
            document.getElementById("quizForm").submit(); // Submit form
        }
    }, 1000);
}

window.onload = function () {
    var fiveMinutes = 60 * 10, // Change to your desired duration
        display = document.querySelector('#time');
    startTimer(fiveMinutes, display);
};
</script>


{% endblock %}